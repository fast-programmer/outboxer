<!DOCTYPE html>
<html>
<head>
  <title>Search Messages</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1>Search Messages</h1>

<form class="row g-3" action="/searches" method="post">
  <!-- Status Checkboxes -->
  <div class="mb-4">
    <h4>Message Search</h4>
    <div class="row">
      <div class="col-12">
        <label><strong>Status:</strong></label>
        <% Outboxer::Models::Message::STATUSES.each do |status| %>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="q[status_in][]" id="status_<%= status %>" value="<%= status %>">
            <label class="form-check-label" for="status_<%= status %>"><%= status.capitalize %></label>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Messageable Attributes -->
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <label for="messageable_type"><strong>Messageable Type:</strong></label>
      <input type="text" name="q[messageable_type_cont]" id="messageable_type" placeholder="Messageable Type" class="form-control">
    </div>
    <div class="col-md-6 col-sm-12">
      <label for="messageable_id"><strong>Messageable ID:</strong></label>
      <input type="text" name="q[messageable_id_eq]" id="messageable_id" placeholder="Messageable ID" class="form-control">
    </div>
  </div>

  <!-- Created At Date Range -->
  <div class="row mt-3">
    <div class="col-md-6 col-sm-12">
      <label for="created_at_to"><strong>Created Before:</strong></label>
      <input type="date" name="q[created_at_lteq]" id="created_at_to" class="form-control">
    </div>

    <div class="col-md-6 col-sm-12">
      <label for="created_at_from"><strong>Created After:</strong></label>
      <input type="date" name="q[created_at_gteq]" id="created_at_from" class="form-control">
    </div>
  </div>

  <!-- Updated At Date Range -->
  <div class="row mt-3">
    <div class="col-md-6 col-sm-12">
        <label for="updated_at_to"><strong>Updated Before:</strong></label>
        <input type="date" name="q[updated_at_lteq]" id="updated_at_to" class="form-control">
    </div>
    <div class="col-md-6 col-sm-12">
        <label for="updated_at_from"><strong>Updated After:</strong></label>
        <input type="date" name="q[updated_at_gteq]" id="updated_at_from" class="form-control">
    </div>

      <!-- Exception Model Search Fields -->
      <div class="mb-4">
        <h4>Exception Search</h4>
        <div class="row g-3">
          <div class="col-md-4">
            <input type="text" name="q[outboxer_exceptions_class_name_cont]" placeholder="Exception Class Name" class="form-control">
          </div>
          <div class="col-md-4">
            <input type="text" name="q[outboxer_exceptions_message_text_cont]" placeholder="Exception Message" class="form-control">
          </div>
          <div class="col-md-4">
            <input type="text" name="q[outboxer_exceptions_backtrace_cont]" placeholder="Exception Backtrace" class="form-control">
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="col-12">
        <button type="submit" class="btn btn-primary mb-3">Search</button>
      </div>
    </form>

    <!-- Search Results -->
    <% if messages.any? %>
      <% messages.each do |message| %>
        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">Message ID: <%= message.id %></h5>
            <p class="card-text">Status: <%= message.status %></p>
            <p class="card-text">Messageable Type: <%= message.messageable_type %></p>
            <p class="card-text">Messageable ID: <%= message.messageable_id %></p>
            <p class="card-text">Created At: <%= message.created_at %></p>
            <!-- Display related exceptions if any -->
            <% if message.outboxer_exceptions.any? %>
              <h6>Exceptions:</h6>
              <% message.outboxer_exceptions.each do |exception| %>
                <p class="card-text">Exception Class: <%= exception.class_name %></p>
                <p class="card-text">Exception Message: <%= exception.message_text %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>No results found</p>
    <% end %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
