#!/usr/bin/env ruby

require 'bundler/setup'
require 'outboxer'

require 'sidekiq'
require 'pry-byebug'

require_relative '../app/jobs/event_handler_job'

binding.pry

option_parser = Outboxer::OptionParser.new(
  banner: 'Usage: example.rb [options]',
  options: { redis_url: 'redis://localhost:6379/0' })

option_parser.on("-r", "--redis_url URL", "URL of the Redis server") do |redis_url|
  option_parser.options[:redis_url] = redis_url
end

option_parser.parse!(ARGV)
options = option_parser.options

Sidekiq.configure_client do |config|
  config.redis = { url: 'redis://localhost:6379/0' }
end

Outboxer::Database.connect!(
  config_path: File.expand_path(options[:db_config_path], __dir__),
  environment: options[:environment])

require_relative '../app/models/event'

require 'irb'
IRB.start(__FILE__)

# bin/console
