<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Outboxer::Publisher
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Outboxer::Publisher";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Outboxer.html" title="Outboxer (module)">Outboxer</a></span></span>
     &raquo; 
    <span class="title">Publisher</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Outboxer::Publisher
  
  
  
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="" title="Outboxer::Publisher (module)">Publisher</a></span></dd>
  </dl>
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="" title="Outboxer::Publisher (module)">Publisher</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/outboxer/publisher.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Publisher/Error.html" title="Outboxer::Publisher::Error (class)">Error</a></span>, <span class='object_link'><a href="Publisher/ThreadAborted.html" title="Outboxer::Publisher::ThreadAborted (class)">ThreadAborted</a></span>
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pop_message!-instance_method" title="#pop_message! (instance method)">#<strong>pop_message!</strong>(queue:, logger:, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish!-instance_method" title="#publish! (instance method)">#<strong>publish!</strong>(thread_count: 5, queue_size: 8, poll_interval: 1, logger: nil, kernel: Kernel, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#push_messages!-instance_method" title="#push_messages! (instance method)">#<strong>push_messages!</strong>(threads:, queue:, queue_size:, poll_interval:, logger:, kernel:)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#running%3F-instance_method" title="#running? (instance method)">#<strong>running?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop!-instance_method" title="#stop! (instance method)">#<strong>stop!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="pop_message!-instance_method">
  
    #<strong>pop_message!</strong>(queue:, logger:, &amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Publisher/ThreadAborted.html" title="Outboxer::Publisher::ThreadAborted (class)">ThreadAborted</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/outboxer/publisher.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pop_message!'>pop_message!</span><span class='lparen'>(</span><span class='label'>queue:</span><span class='comma'>,</span> <span class='label'>logger:</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_outboxer_message'>outboxer_message</span> <span class='op'>=</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Publisher/ThreadAborted.html" title="Outboxer::Publisher::ThreadAborted (class)">ThreadAborted</a></span></span> <span class='kw'>if</span> <span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processing message id: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Message processing failed for id: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

    <span class='const'><span class='object_link'><a href="Message.html" title="Outboxer::Message (module)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_failed!'><span class='object_link'><a href="Message.html#failed!-instance_method" title="Outboxer::Message#failed! (method)">failed!</a></span></span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="Message.html" title="Outboxer::Message (module)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_published!'><span class='object_link'><a href="Message.html#published!-instance_method" title="Outboxer::Message#published! (method)">published!</a></span></span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Message processed successfully for id: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_outboxer_message'>outboxer_message</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish!-instance_method">
  
    #<strong>publish!</strong>(thread_count: 5, queue_size: 8, poll_interval: 1, logger: nil, kernel: Kernel, &amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/outboxer/publisher.rb', line 77</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish!'>publish!</span><span class='lparen'>(</span><span class='label'>thread_count:</span> <span class='int'>5</span><span class='comma'>,</span> <span class='label'>queue_size:</span> <span class='int'>8</span><span class='comma'>,</span> <span class='label'>poll_interval:</span> <span class='int'>1</span><span class='comma'>,</span>
             <span class='label'>logger:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>kernel:</span> <span class='const'>Kernel</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>thread_count:</span> <span class='id identifier rubyid_thread_count'>thread_count</span><span class='comma'>,</span> <span class='label'>queue_size:</span> <span class='id identifier rubyid_queue_size'>queue_size</span><span class='comma'>,</span> <span class='label'>poll_interval:</span> <span class='id identifier rubyid_poll_interval'>poll_interval</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting publisher </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_config'>config</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_queue'>queue</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_trap'>trap</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INT</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="" title="Outboxer::Publisher (module)">Publisher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_stop!'><span class='object_link'><a href="#stop!-instance_method" title="Outboxer::Publisher#stop! (method)">stop!</a></span></span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_thread_count'>thread_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> worker threads</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_threads'>threads</span> <span class='op'>=</span> <span class='id identifier rubyid_thread_count'>thread_count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_pop_message!'>pop_message!</span><span class='lparen'>(</span><span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Publisher/ThreadAborted.html" title="Outboxer::Publisher::ThreadAborted (class)">ThreadAborted</a></span></span>
          <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Thread shutting down</span><span class='tstring_end'>&#39;</span></span>

          <span class='kw'>break</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
          <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
          <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_stop!'>stop!</span>

          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Thread shut down gracefully</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_thread_count'>thread_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> worker threads</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Publishing messages to queue...</span><span class='tstring_end'>&#39;</span></span>

  <span class='kw'>while</span> <span class='ivar'>@running</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_push_messages!'>push_messages!</span><span class='lparen'>(</span>
        <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span>
        <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span>
        <span class='label'>queue_size:</span> <span class='id identifier rubyid_queue_size'>queue_size</span><span class='comma'>,</span>
        <span class='label'>poll_interval:</span> <span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='comma'>,</span>
        <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span>
        <span class='label'>kernel:</span> <span class='const'>Kernel</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_stop!'>stop!</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Publisher shutting down...</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_threads'>threads</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_threads'>threads</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:join</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='op'>&amp;.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Publisher shut down gracefully</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="push_messages!-instance_method">
  
    #<strong>push_messages!</strong>(threads:, queue:, queue_size:, poll_interval:, logger:, kernel:)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/outboxer/publisher.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_push_messages!'>push_messages!</span><span class='lparen'>(</span><span class='label'>threads:</span><span class='comma'>,</span> <span class='label'>queue:</span><span class='comma'>,</span> <span class='label'>queue_size:</span><span class='comma'>,</span> <span class='label'>poll_interval:</span><span class='comma'>,</span> <span class='label'>logger:</span><span class='comma'>,</span> <span class='label'>kernel:</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_messages'>messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_queue_remaining'>queue_remaining</span> <span class='op'>=</span> <span class='id identifier rubyid_queue_size'>queue_size</span> <span class='op'>-</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_messages'>messages</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_queue_remaining'>queue_remaining</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="../Outboxer.html" title="Outboxer (module)">Outboxer</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Message.html" title="Outboxer::Message (module)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpublished!'><span class='object_link'><a href="Message.html#unpublished!-instance_method" title="Outboxer::Message#unpublished! (method)">unpublished!</a></span></span><span class='lparen'>(</span><span class='label'>limit:</span> <span class='id identifier rubyid_queue_remaining'>queue_remaining</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sleeping for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds because there are no messages</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_kernel'>kernel</span><span class='period'>.</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Slept for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>

    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pushing </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> messages to the queue</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pushed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> messages to the queue</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_queue_size'>queue_size</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sleeping for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds because queue length &gt;= queue size</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_kernel'>kernel</span><span class='period'>.</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Slept for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_poll_interval'>poll_interval</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>logger:</span> <span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='label'>threads:</span> <span class='id identifier rubyid_threads'>threads</span><span class='comma'>,</span> <span class='label'>queue:</span> <span class='id identifier rubyid_queue'>queue</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="running?-instance_method">
  
    #<strong>running?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/outboxer/publisher.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_running?'>running?</span>
  <span class='ivar'>@running</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop!-instance_method">
  
    #<strong>stop!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/outboxer/publisher.rb', line 13</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop!'>stop!</span>
  <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Jan 27 22:15:53 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.2.2).
</div>

    </div>
  </body>
</html>